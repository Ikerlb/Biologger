<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

<!-- 
*******************************************************************
*********                                                **********
*********             Autor Alex Aldaco                  **********
*********                                                **********
*******************************************************************
-->

    <body>

        <ui:composition template="./../../WEB-INF/plantillas/system/page.xhtml">
            <ui:param name="tituloDePagina" value="Lista de usuarios" />
            <ui:define name="content">
                <ui:fragment rendered="#{sesion.usuario.rol != 1}">
                    <ui:include src="./../../WEB-INF/plantillas/permisos/permisos-administrador.xhtml" />   
                </ui:fragment>
                <ui:fragment rendered="#{sesion.usuario.rol eq 1}">
                    <h1 class="text-secondary pb-2 border-bottom">
                        #{tituloDePagina}
                    </h1>
                    <form method="Get" class="mb-3">
                        <div  class="form-row">
                            <div class="form-group col">
                                <label for="maxresultados">Resultados</label>
                                <select name="maxresultados" class="custom-select">
                                    <option  value="" disabled="true" selected="true"> 
                                        — #{beanUsuarios.maxResultados} resultados — 
                                    </option>
                                    <option value="10" >10 resultados</option>
                                    <option value="25" >25 resultados</option>
                                    <option value="50" >50 resultados</option>
                                    <option value="100" >100 resultados</option>
                                </select>
                            </div>
                            <div class="form-group col">
                                <label for="rol">Rol</label>
                                <select name="rol" class="custom-select">
                                    <option  value="" disabled="true" selected="true"> 
                                        — #{not empty param.rol ? param.rol : "Seleccionar" } — 
                                    </option>
                                    <option value="administrador" >Administrador</option>
                                    <option value="profesor" >Profesor</option>
                                    <option value="usuario" >Usuario</option>
                                </select>
                            </div>
                            <div class="form-group col">
                                <label for="rol">Estado</label>
                                <select name="estado" class="custom-select">
                                    <option  value="" disabled="true" selected="true"> 
                                        — #{not empty param.estado ? param.estado : "Seleccionar" } — 
                                    </option>
                                    <option value="bloqueado" >Bloqueado</option>
                                    <option value="activo" >Activo</option>
                                </select>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-secondary"><i class="fa fa-filter"></i> Filtrar</button>
                    </form>
                    <h6 class="mb-3">Hay #{beanUsuarios.totalResultados} resultados en esta lista de usuarios. 
                        Estás viendo la página #{beanUsuarios.pagina} de #{beanUsuarios.totalPaginas} 
                        (#{beanUsuarios.maxResultados} resultados por página).
                    </h6>
                    <div class="d-none d-lg-flex flex-row align-items-center pb-3 pt-3 mt-3 mb-3 bg-info text-white border shadow-sm sticky-top">
                        <div class="col-lg-1">
                            <strong>Foto</strong>
                        </div>
                        <div class="col-sm-6 col-lg-11">
                            <div class="row">
                                <div class="col-lg-2">
                                    <strong>Usuario</strong>
                                </div>
                                <div class="col-lg-3">
                                    <strong>Nombre</strong>
                                </div>
                                <div class="col-lg-3 text-truncate">
                                    <strong>Correo</strong>
                                </div>
                                <div class="col-lg-1">
                                    <strong>Rol</strong>
                                </div>
                                <div class="col-lg-1">
                                    <strong>Estado</strong>
                                </div>
                                <div class="col-lg-2">
                                    <strong>Acciones</strong>
                                </div>
                            </div>
                        </div>
                    </div>

                    <c:forEach var="usuario" items="#{beanUsuarios.usuarios}" varStatus="loop" >
                        <div class="col-md-12">
                            <div class="row align-items-center mb-3 pt-3 pb-3 bg-white border shadow-sm">
                                <div class="col-sm-6 col-lg-1">
                                    <h:graphicImage 
                                        value="#{usuario.foto != null ? usuario.foto : '/resources/assets/images/user/icon.png' }" 
                                        class="img-fluid" />
                                </div>
                                <div class="col-sm-6 col-lg-11">
                                    <div class="row">
                                        <div class="col-lg-2">
                                            <div class="d-lg-none">
                                                <strong>Usuario:</strong>
                                            </div>
                                            #{usuario.nombreUsuario}
                                        </div>
                                        <div class="col-lg-3">
                                            <div class="d-lg-none">
                                                <strong>Nombre:</strong>
                                            </div>
                                            #{usuario.nombre}
                                        </div>
                                        <div class="col-lg-3 text-truncate">
                                            <div class="d-lg-none">
                                                <strong>Correo:</strong>
                                            </div>
                                            #{usuario.correo}
                                        </div>
                                        <div class="col-lg-1 text-truncate">
                                            <div class="d-lg-none">
                                                <strong>Rol:</strong>
                                            </div>
                                            #{usuario.rol == 1 ? "Administrador" : usuario.rol == 2 ? "Profesor" : "Usuario" }
                                        </div>
                                        <div class="col-lg-1">
                                            <div class="d-lg-none">
                                                <strong>Estado:</strong>
                                            </div>
                                            #{usuario.activo ? "Activo" : "Bloqueado"}
                                        </div>
                                        <div class="col-lg-2">
                                            <div class="d-lg-none">
                                                <strong>Acciones:</strong>
                                            </div>
                                            <h:link value="Ver" outcome="ver.xhtml?id=#{usuario.id}" class="pr-1"/>
                                            <h:link value="Editar" outcome="editar.xhtml?id=#{usuario.id}" class="pr-1"/>
                                            <h:link value="Eliminar" outcome="eliminar.xhtml?id=#{usuario.id}" class="pr-1"/>
                                        </div>
                                    </div>
                                </div>
                            </div> 
                        </div>
                    </c:forEach>
                    <c:if test="#{beanUsuarios.totalPaginas gt 1}">
                        <nav aria-label="Page navigation example">
                            <ul class="pagination">
                                <c:if test="#{beanUsuarios.pagina gt 1}">
                                    <li class="page-item shadow-sm">
                                        <h:link value="⇦" class="page-link" outcome="lista-de-usuarios.xhtml">
                                            <f:param name="pagina" value="#{beanUsuarios.pagina - 1}" />
                                            <c:if test="#{not empty param.maxresultados}">
                                                <f:param name="maxresultados" value="#{param.maxresultados}" />
                                            </c:if>
                                            <c:if test="#{not empty param.rol}">
                                                <f:param name="rol" value="#{param.rol}" />
                                            </c:if>
                                            <c:if test="#{not empty param.estado}">
                                                <f:param name="estado" value="#{param.estado}" />
                                            </c:if>
                                        </h:link>
                                    </li>
                                </c:if>
                                <c:forEach var="loop" 
                                           begin="#{beanUsuarios.pagina gt 4 ? 
                                                        beanUsuarios.totalPaginas - beanUsuarios.pagina gt 3 ? 
                                                        beanUsuarios.pagina - 3 : beanUsuarios.totalPaginas - 6 gt 0 ?
                                                            beanUsuarios.totalPaginas - 6
                                                        :
                                                            1
                                                   : 
                                                        1}" 
                                           end="#{beanUsuarios.pagina gt 4 ? 
                                                    beanUsuarios.pagina + 3 gt beanUsuarios.totalPaginas ? 
                                                        beanUsuarios.totalPaginas : beanUsuarios.pagina + 3 
                                                    : 
                                                     beanUsuarios.totalPaginas lt 7 ? 
                                                        beanUsuarios.totalPaginas : 7
                                                }">
                                    <li class="page-item shadow-sm #{beanUsuarios.pagina == loop ? 'active':''}">
                                        <h:link value="#{loop}" class="page-link" outcome="lista-de-usuarios.xhtml">
                                            <f:param name="pagina" value="#{loop}" />
                                            <c:if test="#{not empty param.maxresultados}">
                                                <f:param name="maxresultados" value="#{param.maxresultados}" />
                                            </c:if>
                                            <c:if test="#{not empty param.rol}">
                                                <f:param name="rol" value="#{param.rol}" />
                                            </c:if>
                                            <c:if test="#{not empty param.estado}">
                                                <f:param name="estado" value="#{param.estado}" />
                                            </c:if>
                                        </h:link>
                                    </li>
                                </c:forEach>
                                <c:if test="#{beanUsuarios.pagina lt beanUsuarios.totalPaginas}">
                                    <li class="page-item shadow-sm">
                                        <h:link value="⇨" class="page-link" outcome="lista-de-usuarios.xhtml">
                                            <f:param name="pagina" value="#{beanUsuarios.pagina + 1}" />
                                            <c:if test="#{not empty param.maxresultados}">
                                                <f:param name="maxresultados" value="#{param.maxresultados}" />
                                            </c:if>
                                            <c:if test="#{not empty param.rol}">
                                                <f:param name="rol" value="#{param.rol}" />
                                            </c:if>
                                            <c:if test="#{not empty param.estado}">
                                                <f:param name="estado" value="#{param.estado}" />
                                            </c:if>
                                        </h:link>
                                    </li>
                                </c:if>
                            </ul>
                        </nav>
                    </c:if>
                </ui:fragment>
            </ui:define>

        </ui:composition>

    </body>
</html>
