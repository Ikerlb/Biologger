<?xml version='1.0' encoding='UTF-8' ?> 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">

<!-- 
*******************************************************************
*********                                                **********
*********             Autor Alex Aldaco                  **********
*********                                                **********
*******************************************************************
-->

    <h:body>
        <ui:composition template="/WEB-INF/plantillas/system/page.xhtml">
            <c:if test="#{beanCategoria.categorias.size() gt 0}">
                <ui:param name="Sidebar" value="true" />
            </c:if>
            <ui:param name="tituloDePagina" value="Catálogo de materiales" />
            <ui:define name="content" >
                <h1 class="text-secondary pb-2 mb-3 border-bottom">
                    #{tituloDePagina}
                </h1>
                <h:form class="mb-3">
                    <div  class="form-row">
                        <div class="form-group col-12">
                            <h:outputLabel for="nombre"  value="Nombre" />
                            <h:inputText value="#{catalogo.nombre}" class="form-control" id="nombre" />
                        </div>
                        <div class="form-group col-12">
                            <h:outputLabel for="descripcion"  value="Descripcion" />
                            <h:inputText value="#{catalogo.descripcion}" class="form-control" id="descripcion" />
                        </div>
                        <div class="form-group col">
                            <h:outputLabel for="estado" value="Estado"/>
                            <h:selectOneMenu value="#{catalogo.estado}" id="estado" class="custom-select" >
                                <f:selectItem itemValue="" itemLabel="— Seleccionar —" />
                                <f:selectItem itemValue="Disponible" itemLabel="Disponible" />
                                <f:selectItem itemValue="No Disponible" itemLabel="No Disponible" />
                            </h:selectOneMenu>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="col">
                            <h:outputLabel for="orden"  value="Orden" />
                            <h:selectOneMenu value="#{catalogo.orden}" id="orden" class="custom-select custom-select-sm" >
                                <f:selectItem itemValue="id" itemLabel="ID del material" />
                                <f:selectItem itemValue="nombre" itemLabel="Nombre" />
                                <f:selectItem itemValue="descripcion" itemLabel="Descripcion" />
                                <f:selectItem itemValue="estado" itemLabel="Estado" />
                            </h:selectOneMenu>
                        </div>
                        <div class="col">
                            <h:outputLabel for="modo"  value="Modo" />
                            <h:selectOneMenu value="#{catalogo.modo}" id="modo" class="custom-select custom-select-sm" >
                                <f:selectItem itemValue="ASC" itemLabel="Ascendente" />
                                <f:selectItem itemValue="DESC" itemLabel="Descendente" />
                            </h:selectOneMenu>
                        </div>
                        <div class="form-group col">
                            <h:outputLabel for="maxresultados" value="Resultados"/>
                            <h:selectOneMenu value="#{catalogo.maxResultados}" id="maxresultados" class="custom-select custom-select-sm" >
                                <f:selectItem itemValue="25" itemLabel="25 resultados" />
                                <f:selectItem itemValue="50" itemLabel="50 resultados" />
                                <f:selectItem itemValue="75" itemLabel="75 resultados" />
                                <f:selectItem itemValue="100" itemLabel="100 resultados" />
                            </h:selectOneMenu>
                        </div>
                    </div>
                    <h:commandLink action="#{catalogo.filtrar()}" class="btn btn-primary" >
                        <i class="fa fa-filter"></i> Filtrar
                    </h:commandLink>
                </h:form>
                <ui:fragment rendered="#{catalogo.totalResultados eq 0}">
                    <h2 class="display-3 text-danger text-center">OoopSss!</h2>
                    <h3 class="text-center">Lo sentimos, no hay resultados para esta consulta.</h3>
                </ui:fragment>
                <ui:fragment rendered="#{catalogo.totalResultados gt 0}">
                    <p class="mb-3">Hay #{catalogo.totalResultados} resultados en esta lista de usuarios. 
                        Estás viendo la página #{catalogo.pagina} de #{catalogo.totalPaginas} 
                        (#{catalogo.maxResultados} resultados por página).
                    </p>
                    <div class="d-none d-lg-flex flex-row align-items-center pb-3 pt-3 mt-3 mb-3 bg-info text-white border shadow-sm sticky-top">
                        <div class="col-lg-1">
                            <strong>Foto</strong>
                        </div>
                        <div class="col-sm-6 col-lg-11">
                            <div class="row">
                                <div class="col-lg-3 text-truncate">
                                    <strong>Nombre</strong>
                                </div>
                                <div class="col-lg-4 text-truncate">
                                    <strong>Descripcion</strong>
                                </div>
                                <div class="col-lg-2">
                                    <strong>Estado</strong>
                                </div>
                                <div class="col-lg-2">
                                    <strong>Acciones</strong>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <c:forEach var="material" items="#{catalogo.materiales}" varStatus="loop" >
                        <div class="col-md-12">
                            <div class="row align-items-center mb-3 pt-3 pb-3 bg-white border shadow-sm">
                                <div class="col-sm-6 col-lg-1">
                                    <h:graphicImage 
                                        value="#{material.foto}" 
                                        class="img-fluid" />
                                </div>
                                <div class="col-sm-6 col-lg-11">
                                    <div class="row">
                                        <div class="col-lg-3">
                                            <div class="d-lg-none text-truncate">
                                                <strong>Nombre</strong>
                                            </div>
                                            #{material.nombre}
                                        </div>
                                        <div class="col-lg-4">
                                            <div class="d-lg-none text-truncate">
                                                <strong>Descripcion</strong>
                                            </div>
                                            #{trimString.resumen(material.descripcion,200)}
                                        </div>
                                        <div class="col-lg-2">
                                            <div class="d-lg-none">
                                                <strong>Estado:</strong>
                                            </div>
                                            <span class="#{material.disponible() ? 'badge badge-pill badge-success': 'badge badge-pill badge-warning'}">#{material.estado}</span>
                                        </div>
                                        <div class="col-lg-3">
                                            <div class="d-lg-none">
                                                <strong>Acciones:</strong>
                                            </div>
                                            <h:form>
                                                <h:commandLink action="#{carrito.agregarAlCarrito(material)}" 
                                               value="Agregar al carrito" class="btn btn-primary btn-sm pr-2" 
                                               rendered="#{not carrito.seleccionado(material)}" />
                                                <h:commandLink action="#{carrito.eliminarDelCarrito(material)}" 
                                               value="Eliminar del carrito" class="btn btn-danger btn-sm pr-2" 
                                               rendered="#{carrito.seleccionado(material)}" />
                                            </h:form>
                                            <!--<h:link value="Ver" outcome="/admin/material/ver.xhtml?id=#{material.id}" class="pr-1"/>
                                            <h:link value="Editar" outcome="/admin/material/editar.xhtml?id=#{material.id}" class="pr-1"/>-->
                                        </div>
                                    </div>
                                </div>
                            </div> 
                        </div>
                    </c:forEach>
                </ui:fragment>
                    <c:if test="#{catalogo.totalPaginas gt 1}">
                        <nav aria-label="Page navigation example">
                            <ul class="pagination">
                                <c:if test="#{catalogo.pagina gt 1}">
                                    <li class="page-item shadow-sm">
                                        <h:link value="⇦" class="page-link" outcome="catalogo.xhtml">
                                            <f:param name="pagina" value="#{catalogo.pagina - 1}" />
                                            <c:if test="#{not empty param.maxresultados}">
                                                <f:param name="maxresultados" value="#{param.maxresultados}" />
                                            </c:if>
                                            <c:if test="#{not empty param.nombre}">
                                                <f:param name="nombre" value="#{param.nombre}" />
                                            </c:if>
                                            <c:if test="#{not empty param.descripcion}">
                                                <f:param name="rol" value="#{param.descripcion}" />
                                            </c:if>
                                            <c:if test="#{not empty param.estado}">
                                                <f:param name="estado" value="#{param.estado}" />
                                            </c:if>
                                            <c:if test="#{not empty param.orden}">
                                                <f:param name="orden" value="#{param.orden}" />
                                            </c:if>
                                            <c:if test="#{not empty param.modo}">
                                                <f:param name="modo" value="#{param.modo}" />
                                            </c:if>
                                        </h:link>
                                    </li>
                                </c:if>
                                <c:forEach var="loop" 
                                           begin="#{catalogo.pagina gt 4 ? 
                                                        catalogo.totalPaginas - catalogo.pagina gt 3 ? 
                                                        catalogo.pagina - 3 : catalogo.totalPaginas - 6 gt 0 ?
                                                            catalogo.totalPaginas - 6
                                                        :
                                                            1
                                                   : 
                                                        1}" 
                                           end="#{catalogo.pagina gt 4 ? 
                                                    catalogo.pagina + 3 gt catalogo.totalPaginas ? 
                                                        catalogo.totalPaginas : catalogo.pagina + 3 
                                                    : 
                                                     catalogo.totalPaginas lt 7 ? 
                                                        catalogo.totalPaginas : 7
                                                }">
                                    <li class="page-item shadow-sm #{catalogo.pagina == loop ? 'active':''}">
                                        <h:link value="#{loop}" class="page-link" outcome="catalogo.xhtml">
                                            <f:param name="pagina" value="#{loop}" />
                                            <c:if test="#{not empty param.maxresultados}">
                                                <f:param name="maxresultados" value="#{param.maxresultados}" />
                                            </c:if>
                                            <c:if test="#{not empty param.nombre}">
                                                <f:param name="nombre" value="#{param.nombre}" />
                                            </c:if>
                                            <c:if test="#{not empty param.descripcion}">
                                                <f:param name="rol" value="#{param.descripcion}" />
                                            </c:if>
                                            <c:if test="#{not empty param.estado}">
                                                <f:param name="estado" value="#{param.estado}" />
                                            </c:if>
                                            <c:if test="#{not empty param.orden}">
                                                <f:param name="orden" value="#{param.orden}" />
                                            </c:if>
                                            <c:if test="#{not empty param.modo}">
                                                <f:param name="modo" value="#{param.modo}" />
                                            </c:if>
                                        </h:link>
                                    </li>
                                </c:forEach>
                                <c:if test="#{catalogo.pagina lt catalogo.totalPaginas}">
                                    <li class="page-item shadow-sm">
                                        <h:link value="⇨" class="page-link" outcome="catalogo.xhtml">
                                            <f:param name="pagina" value="#{catalogo.pagina + 1}" />
                                            <c:if test="#{not empty param.maxresultados}">
                                                <f:param name="maxresultados" value="#{param.maxresultados}" />
                                            </c:if>
                                            <c:if test="#{not empty param.nombre}">
                                                <f:param name="nombre" value="#{param.nombre}" />
                                            </c:if>
                                            <c:if test="#{not empty param.descripcion}">
                                                <f:param name="rol" value="#{param.descripcion}" />
                                            </c:if>
                                            <c:if test="#{not empty param.estado}">
                                                <f:param name="estado" value="#{param.estado}" />
                                            </c:if>
                                            <c:if test="#{not empty param.orden}">
                                                <f:param name="orden" value="#{param.orden}" />
                                            </c:if>
                                            <c:if test="#{not empty param.modo}">
                                                <f:param name="modo" value="#{param.modo}" />
                                            </c:if>
                                        </h:link>
                                    </li>
                                </c:if>
                            </ul>
                        </nav>
                    </c:if>
                
            </ui:define>
            <ui:define name="sidebar" >
                <h3 class="text-secondary border-bottom pt-2 pb-2 mb-3">
                    <i class="fa fa-tags small"></i> Categorías
                </h3>
                <ui:include src="./WEB-INF/plantillas/recursiva/categorias-menu.xhtml" />
            </ui:define>
        </ui:composition>
    </h:body>

</html>